window.onload = app;
window.MRCategoryLabels = {"1":"Seating","3":"Desks","4":"Case Goods","6":"Side & Office Chairs","7":"Sofas & Benches","13":"Thonet","14":"Miscellaneous","15":"Vecta","19":"Conference Tables","20":"Jens Risom","21":"Herman Miller Burdick Group","22":"Jens Risom","23":"Miscellaneous","24":"Zographos","31":"Herman Miller","32":"Dunbar","35":"Krueger","40":"Miscellaneous","41":"Dunbar","42":"Miscellaneous","51":"Knoll","52":"Brayton International","53":"Frank Lloyd Wright","54":"Frank Lloyd Wright","56":"Herman Miller","58":"Herman Miller","61":"Ward Bennett","62":"Lounge","64":"Miscellaneous Lounges","65":"Stow Davis","67":"Herman Miller","68":"Knoll","69":"Dunbar","72":"Brayton International","73":"Steelcase","74":"Dunbar","75":"Stendig","76":"Weiman","77":"Epp Brothers","78":"Dunbar","81":"Brayton International","82":"Plycraft","85":"Brno Chairs-Not Knoll","86":"Larsen","88":"Side/Low Tables","89":"Vecta","91":"Miscellaneous","92":"Corporate Art - Paintings, Prints, & Posters","94":"Harvey Probber","95":"Screens","99":"Knoll","106":"Stow Davis","107":"Artifort","108":"Drafting Tables & Files","111":"Dining Tables","112":"Knoll","113":"Herman Miller","114":"Vecta","115":"Danish","116":"Saarinen","117":"Miscellaneous","119":"Ottomans","120":"Miscellaneous","122":"Zographos","124":"Scandinavian","127":"Rugs","132":"Sligh Furniture","133":"Rubbermaid","134":"Kittinger","135":"Saarinen","136":"Knoll","137":"Marble Tables","138":"Herman Miller","139":"Zographos","140":"Stow Davis","141":"Scandinavian","142":"Kittinger","143":"Stow Davis","145":"Scandinavian","146":"Steelcase","147":"Glass Tables","148":"Herman Miller","149":"Cushions & Pillows","151":"Thayer Coggin","152":"Steelcase","153":"Baker","154":"Stow Davis","155":"Kimball","159":"Josef Hoffmann","160":"Stow Davis","161":"Franklin Shockey","164":"Hickory","166":"Hickory","167":"Weiman","168":"New Furniture","170":"New Modern Glass/Acrylic Furniture","179":"_non-category","192":"_non-category","194":"_non-category","215":"_non-category","221":"_non-category","227":"_non-category","229":"Grand Deco","231":"Stresa","232":"Knife Edge","233":"M and M","234":"Taxia","235":"_non-category","236":"New Classic 1950 Design","238":"Krueger","239":"Knoll","240":"Case Study Shelving","241":"Shell Chairs","242":"Bases","243":"Side Shell Chairs","244":"Arm Shell Chairs","245":"Outdoor Furniture","247":"Side Tables","248":"Dining Chairs","249":"Dining Tables","250":"Coffee Tables","251":"Lounge Chairs & Sofas","252":"Lounge Chairs","253":"Split Rail Series","254":"Bedroom Furniture","256":"Lighting","257":"810 Series","258":"Astor Series","259":"Avanti Series","260":"Beverly Series","261":"Case Study Series","262":"Cloud Series","263":"Delano Series","264":"Impala Series","265":"L-29 Series","266":"Vanguard Series","268":"Bubble Lamps","271":"Plycraft","272":"Scandinavian","273":"Thayer Coggin","275":"_non-category","277":"_non-category","278":"_non-category","280":"Vitra","283":"Fritz Hansen","284":"GF - General Fireproofing","285":"Le Corbusier","286":"Ward Bennett","288":"Library Furniture","289":"Armoire & Entertainment Center","290":"Clocks","291":"Leghigh Leopold","292":"Scandinavian","294":"New Zographos Designs Limited","295":"Bucket Chairs","296":"Pull Out Chairs","297":"Metro","298":"Brickel Ward Bennett","299":"Lehigh Leopold","300":"Hamilton Drafting Tables","301":"Heywood Wakefield","302":"Bedroom Furniture","303":"Knoll","304":"Eero Saarinen","305":"Mies van der Rohe","306":"Max Pearson","307":"Marcel Breuer","308":"Bill Stephens","309":"Don Petitt","310":"Charles Pollock","311":"Harry Bertoia","312":"Miscellaneous Knoll","313":"Modular/Theater Seating","317":"Stendig","318":"Conant Ball","320":"Conant Ball","321":"Enron Architecture Drawings & Models","322":"Recent Arrivals","323":"Drexel","324":"Scandinavian","325":"Stacking Chairs","326":"Vecta","327":"Martela","328":"Drexel","329":"Drexel","330":"Bernhardt Designs","331":"Steelcase","332":"Dining Room Sets","333":"Tables","334":"Heywood Wakefield","335":"Other","337":"Jofco Jasper","338":"Mies van der Rohe","339":"Harvey Probbar","340":"Harvey Probber","341":"_non-category","342":"_non-category","343":"Stendig","344":"Table Bases","345":"Conant Ball/ Russell Wright","346":"Patrician","347":"Cassina","348":"Corporate Art","349":"_non-category","350":"Stendig","351":"Metro","352":"Cassina","353":"Cassina","354":"Zographos","355":"Artesian","356":"Classico","357":"B&B Italia","358":"_non-category","359":"Heywood Wakefield","360":"Sunar Limited","361":"Stools","362":"_non-category","363":"_non-category","364":"Stow Daviss","365":"Crystal & Glass","366":"Cassina","367":"Ponti","368":"Kittinger","369":"Laminate Tables","370":"Drexel","371":"Heywood Wakefield","372":"Paul McCobb","373":"Paul McCobb","375":"Edward Wormley","376":"Edward Wormley","377":"Edward Wormley","378":"Edward Wormley","379":"Edward Wormley","380":"Kroehler","381":"Koehler","382":"Wood Tables","383":"_non-category","385":"Alexander Calder","386":"San Francisco Earthquake","387":"Kroehler","388":"Conant Ball/Russel Wright","389":"Leather Center","390":"Herman Miller","391":"Side Shell Chairs","392":"Arm Shell Chairs","393":"Aluminum Group Chairs","394":"Milo Baughman","395":"Art","396":"Other Eames Chairs","397":"Other Herman Miller","399":"_non-category","400":"_non-category","401":"_non-category","402":"_non-category","403":"Baker","404":"Miscellaneous","405":"Traditional","406":"Traditional","407":"Art","408":"Digital","409":"Mixed Media","410":"Paintings","411":"Photographs","412":"Posters","413":"Prints","414":"Scupltures","415":"Other Art","420":"Dining Bases","421":"Low Bases","422":"Bill Stephens","423":"Jens Risom","424":"Saarinen","425":"Mies Van Der Rohe","426":"Warren Platner","427":"Cafiero","428":"Pfister","429":"Hannah Morrison","430":"Gae Aulenti","431":"Harry Bertoia","432":"Knoll Miscellaneous","433":"Marcel Breuer","434":"Suzanne","435":"Zapf","436":"Jens Risom","437":"Console Table","438":"Console Bases","439":"Acrylic Tables","440":"Burke","441":"Milo Baughman","442":"Steelcase","443":"Night Stands","444":"Outdoor","445":"Industrial","446":"Knoll","447":"Herman Miller","448":"Marble","449":"Miscellaneous","450":"Steelcase","451":"Vecta","452":"Councill","453":"Zographos","454":"Helikon","455":"Burdick","456":"Stow Davis","457":"Wood","459":"Baker","460":"Eames","461":"Traditional","462":"Traditional","463":"Thonet","465":"Serving Carts","466":"Serving Carts","467":"Milo Baughman","468":"Porcelain & Ceramic","470":"Herman Miller","471":"Other","472":"Seating","473":"Tables","474":"Desks","476":"Miscellaneous","477":"Casegoods","478":"Lounge","479":"Side & Office","480":"Sofa & Benches","481":"Stools","482":"Dining & Conference","483":"Console","484":"Side/Coffee Table","485":"Fritz Hansen","486":"Jens Risom","487":"Jens Risom","488":"Edward Wormley","489":"Other","490":"Baker","491":"Oriental","492":"Modern","493":"Cafe/Bar Tables","494":"Large Quantities","495":"Large Quantities","496":"Marble","497":"*Carrara","498":"*Calacatta","499":"Rojo/Rosso","500":"*Black","501":"*Green","502":"*Miscellaneous Colors","503":"Granite","504":"Bedroom","505":"Dressers & Chests","506":"Nightstands","507":"Bed Frames & Headboards","508":"Armoires/Wardrobes","509":"Mirrors","510":"Bedroom Sets","511":"Bar","512":"Fiberglass Chairs","513":"Upholstered Chairs","514":"Textiles","516":"Fabric","517":"Italian Composition Leather/Vinyl","518":"Leather","519":"_non-category","522":"Adrian Pearsall","523":"_non-category","524":"International","525":"Large Quantities","526":"Clearance","527":"Art Deco","528":"Lighting","529":"Scandinavian","530":"Credenzas","531":"Chandeliers","532":"Ceiling Lamps","533":"Floor Lamps","534":"Table Lamps","535":"Sconces","537":"Files"};
window.MRCategoryMap = {"1":["494","62","313","119","6","7","325","361"],"3":["318","323","41","375","77","54","94","31","21","20","337","368","239","238","525","291","42","373","133","292","132","152","143","360","462","326"],"4":["289","511","320","530","370","32","537","53","161","56","334","22","99","299","23","124","140","461"],"6":["107","403","81","85","440","366","329","366","78","378","283","284","390","301","164","487","159","155","142","303","380","35","86","389","327","394","14","372","82","367","145","442","75","106","151","13","405","89","280","61","76","24"],"7":["522","357","153","52","298","353","74","340","58","51","381","351","467","40","324","331","317","154","463","15"],"19":["459","452","454","447","446","448","449","450","456","451","457","453"],"62":["330","352","72","69","377","485","339","67","486","68","387","285","297","338","441","64","346","271","141","73","350","65","273","286","354"],"68":["422","427","430","429","431","423","432","433","425","428","424","434","426"],"88":["439","347","345","376","147","138","359","166","134","136","137","404","135","272","465","146","364","382","139"],"91":["395","302","290","348","92","365","195","108","321","524","288","509","120","468","95"],"108":["300","148","335"],"111":["490","388","115","328","379","113","371","112","117","116","343","160","114","167","122"],"127":["491","492"],"168":["355","236","170","294"],"236":["254","240","250","248","249","256","251","245","241","247"],"241":["242","243","244"],"251":["257","258","259","260","261","262","263","264","265","252","253","266"],"256":["268"],"294":["295","296"],"303":["308","310","309","304","311","436","307","306","305","312","435"],"333":["493","19","437","332","111","469","369","495","443","466","88","344"],"344":["438","420","421"],"355":["356"],"370":["488","489"],"406":["477","474","476","472","473"],"407":["408","409","415","410","411","412","413","414"],"447":["455","460"],"469":["470","471"],"472":["478","479","480","481"],"473":["482","483","484"],"496":["500","498","497","501","502","499","503"],"504":["505","506","507","508","510"],"514":["516","517","518"],"528":["532","531","533","535","534"],"top-level":["407","527","504","4","526","3","445","528","496","91","168","444","322","127","529","1","333","514","406"]};
 Array.prototype.sum = function(len){
    len = (len||2)
    var total = 0;
    for (var i = 0 , ii = this.length ; i<ii ; ++i) {
        if(isNaN(this[i]))
            this[i] = 0;
        total += parseInt((Number(this[i]) * 10000)+.01)
    }
    
    return Number((total/10000).toFixed(len));
}
// runs when the DOM is loaded
function app(){
    "use strict";

    // uncomment the following line to cache CSS/JS files loaded by loader in localStorage
    // NOTE: you may need to turn this off while developing
    // loader.textInjection = true;

    // load some scripts (uses promises :D)
    loader.load(
        //css
        {url: "./dist/style.css"},
        //js
        {url: "./bower_components/jquery/dist/jquery.min.js"},
        {url: "./bower_components/lodash/lodash.min.js"},

        // when using just Backbone, use this line
        {url: "./bower_components/backbone/backbone.js"},
        // when using Parse, comment out the above line and uncomment the line below
        {url: "./bower_components/parse-js-sdk/lib/parse.min.js"},

        // when using React (and the plugin JSnoX), uncomment the following two lines
        // {url: "./bower_components/react/react.min.js"},
        // {url: "./bower_components/jsnox/jsnox.js"},

        // other stuff
        // -------------
        // bootstrap carousel
        {url: "./bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/carousel.js"},
        {url: "./bower_components/bootstrap-sass-official/assets/javascripts/bootstrap/collapse.js"},

        {url: "./bower_components/pace/pace.min.js"},
        {url: "./js/TemplateView.js"} ,

        //my app
        //
        // {url: "./js/utility/utilityFunctions.js"} ,

        // {url: "./js/app/models.js"} ,

        // {url: "./js/app/adminView.js"} ,
        // {url: "./js/app/categoriesView.js"} ,
        // {url: "./js/app/cartView.js"} ,
        // {url: "./js/app/employeeViews.js"} ,
        // {url: "./js/app/homeView.js"} ,
        //Phil's Change
        // {url: "./js/app/miscViews.js"} ,
        //alex's change
        // {url: "./js/app/multiView.js"} ,
        // {url: "./js/app/pageLayoutElements.js"} ,
        // {url: "./js/app/singleView.js"} ,
        // {url: "./js/Client.js"} ,

        //DATA SCRIPTS
        // ,{url: "./data/INPUT-totalSet.js"}
        // ,{url: "./data/INPUT-jpegData.js"}
        // ,{url: "./data/INPUT-productInfo.js"}
        // ,{url: "./data/EXECUTE-GenerateParseData.js"}
        // ,{url: "./js/db/databaseFunctions.js"}

        {url: "./data/scripts-organizeCategories/categoryMap2.js"} ,
        {url: "./data/scripts-organizeCategories/allCategories.js"}


    ).then(function(){
        // if turning on JSnoX, uncommment the following line
        // window.d = jsnox(React);
        // if turning on React, uncomment the following line
        // React.initializeTouchEvents(true);
        document.querySelector("html").style.opacity = 1;

        // start app?
        Parse.initialize('8cefZxGY6FiSAhEw5YCwN9mBjgoiUgGcdJnTZgdy','RWjs5EKsDkBlZ1L05crkUetjonIG1DGNiaM664OY');
        Parse.FurnitureItem = Parse.Object.extend({
                className: "mrInventory",

                defaults: {
                },

                initialize: function() {
                    var self = this

                    //sanity check for price: if no price entered, then listed=false

                    this.on('change', function() {
                        self.save()
                    })
                },

                validate: function() {

                }
        });

        var Router = new (Backbone.Router.extend({
            routes : {
                'add-employee' : 'add-employee',
                'employee' : 'employee',
                '':'root' ,
                'mod-item' : 'add-item' ,
                'edit-item' : 'edit-item' 
                // 'return-to-dash':'return-to-dash'
            } ,
            initialize: function() {
                Backbone.history.start();
            } ,
            // 'return-to-dash': function() {
            // } ,
            employee: function() {
                if (!Parse.User._currentUser){
                    window.location.hash = '';
                    return
                }
                $('.return-to-dash').addClass('hidden')
                $('.newEmployee').addClass('hidden');

                if (Parse.User._currentUser.get('role')==='admin')
                    $('.newEmployee').removeClass('hidden');

                $('main').addClass('inactive');
                $('.employee-dashboard').removeClass('inactive');
            } ,
            'edit-item': function() {
                if (!Parse.User._currentUser){
                    window.location.hash = '';
                    return
                }
                $('.uploaded-files').html('');
                window['newItem'] = {};
                // debugger

                $('.return-to-dash').removeClass('hidden')
                $('main').addClass('inactive');
                $('.MR-choose').removeClass('inactive');
            } ,
            'add-item': function() {
                if (!Parse.User._currentUser){
                    window.location.hash = '';
                    return
                }
                $('.uploaded-files').html('');
                $('.return-to-dash').removeClass('hidden')
                
                $('main').addClass('inactive');
                $('.enter-new-item').removeClass('inactive');
            } ,
            'add-employee':function() {
                if (!Parse.User._currentUser){
                    window.location.hash = '';
                    return;
                }
                if(Parse.User._currentUser.get('role')!=='admin')
                    return;
                $('.return-to-dash').removeClass('hidden')
                $('main').addClass('inactive');
                $('.dashboard').removeClass('inactive');

            },
            root:function() {
                $('.return-to-dash').addClass('hidden')
                $('main').addClass('inactive');
                $('.login').removeClass('inactive');
            }
        }))();

        ////////////////////////
        // dashboard navigation buttons
        $('.newItem').on('click' , function(e) {
            e.preventDefault();
            window['newItem'] = {};
            window.location.hash = 'mod-item';
            $('.newItemField').val('');
            return false;
        });
        $('.editItem').on('click' , function(e) {
            e.preventDefault();
            window['newItem'] = {};
            window.location.hash = 'edit-item';
            return false;
        });
        $('.newEmployee').on('click' , function(e) {
            window.location.hash = 'add-employee';
        });
        $('.return-to-dash').on('click' , function() {
            window.location.hash = 'employee';
        });
        //
        ////////////////////////


        ////////////////////////
        // form submit buttons

        // submit for login 
        $('.admin-login-btn').on('click' , function(e) {
            e.preventDefault();
            Parse.User.logIn($('#login-name').val() , $('#login-password').val())
                .then(function(parseUser) {
                    $('#login-name').val('') , $('#login-password').val('')
                    window.location.hash = 'employee';
                })
                .fail(function(error) {
                    $('.response-msg').text("Username doesn't exist or password is invalid").fadeIn();
                });
            return false;
        });
        // submit for add employee
        $('.add-new-employee').on('click' , function(e) {
            e.preventDefault();

            var name = $('.new-employee-username').val();
            var password = $('.new-employee-password').val();

            if (name.length > 0 && password.length > 0) {
                // $('body').append('<iframe src=http://blazinweb.com/test/newUser.asp?n='+name+'&p='+password+'>')
                var user = new Parse.User();
                
                user.set('username', name);
                user.set('password', password);
                user.set('role', 'employee');

                user.signUp()
                    .then(function(newUser) {
                        Parse.User.logOut();
                        window.location.hash = '';
                        $('.response-msg').text('new employee submitted').show().fadeOut(1000);
                        $('.new-employee-username').val("");
                        $('.new-employee-password').val("");

                    }).fail(function(error) {
                        $('.response-msg').text('didnt work user not submitted, sorry...').show().fadeOut(1000);
                    })
            } else {
                $('.response-msg').text('enter values for new employee and new password').show().fadeOut(1000);
            }

            return false;
        });
        // submit for add item and edit item
        $('.newItemSubmit').on('click' , function(e) {
            e.preventDefault();

            var item = new (Parse.Object.extend("mrInventory"));
        
            if(!newItem.MR_id)
                new Parse.Query(Parse.FurnitureItem)
                    .descending("MR_id")
                    .limit(1)
                    .find().then(function(results) {

                        newItem.MR_id = results[0].get('MR_id')+1;

                        newItem.thirdPartyVendors = [];
                        
                        newItem.isConsigned = $('.isConsigned')[0].checked;
                        $('.thirdPartyVendors').each(function(){
                            if (this.checked)
                                newItem.thirdPartyVendors.push(this.value)
                        })
                        _.each(newItem , function(v,i) {
                            item.set(i , v);
                        });

                        $('main').addClass('inactive');
                        $('.MR-modal').removeClass('inactive');
                        $('#MR-data').html('<h3>MR-ID:<br>' + newItem.MR_id + '</h3>');
                    });
            else
                new Parse.Query(Parse.FurnitureItem)
                    .equalTo("MR_id", Number($('.MR-choose-data').val()))
                    .find().then(function(results) {

                        window.location.hash = 'mod-item';
                        newItem.thirdPartyVendors = [];
                        
                        newItem.isConsigned = $('.isConsigned')[0].checked;
                        $('.thirdPartyVendors').each(function(){
                            if (this.checked)
                                newItem.thirdPartyVendors.push(this.value)
                        })
                        _.each(newItem , function(v,i) {
                            results[0].set(i , v);
                        });

                        $('main').addClass('inactive');
                        $('.MR-modal').removeClass('inactive');
                        $('#MR-data').html('<h3>MR-ID:<br>' + newItem.MR_id + '</h3>');
                    });

            return false;
        });

        //
        ////////////////////////

        // pull a record by MR_id
        $('.MR-choose-select').on('click' , function() {

            new Parse.Query(Parse.FurnitureItem)
                .equalTo("MR_id", Number($('.MR-choose-data').val()))
                .find().then(function(results) {
                    _.each(JSON.parse(JSON.stringify(results[0])) , function(value , field) {
                        newItem[field] = value;
                        if ($('input[title='+field+']')[0])
                            $('input[title='+field+']').val(value)

                    });

                    $('.isConsigned')[0].checked = newItem.isConsigned;
                    $('.thirdPartyVendors').each(function(){
                        if (newItem.thirdPartyVendors && newItem.thirdPartyVendors.indexOf(this.value)>-1)
                            this.checked = true
                    })
                    window.location.hash = 'mod-item';
                });
        });

        // build MR categories from map
        $.each(MRCategoryMap['top-level'], function (index, value) {
            $('.top-level-category').append($('<option/>', { 
                value: value,
                text : MRCategoryLabels[value]
            }));
        });

        ////////////////////////
        // handle all inputs for form on add/edit item

        $('.top-level-category').on('change',function() {
            $('.subcategory-group-1 ').addClass('hidden')
            $('.sub-category-1 ').html('')
            if(MRCategoryMap[this.value])
                $.each(MRCategoryMap[this.value], function (index, value) {
                    $('.subcategory-group-1 ').removeClass('hidden')
                    $('.sub-category-1').append($('<option/>', { 
                        value: value,
                        text : MRCategoryLabels[value]
                    }));
                }); 
        });
        $('.sub-category-1').on('change',function() {
            $('.subcategory-group-2 ').addClass('hidden')
            $('.sub-category-2 ').html('')
            if(MRCategoryMap[this.value])
                $.each(MRCategoryMap[this.value], function (index, value) {
                    $('.subcategory-group-2 ').removeClass('hidden')
                    $('.sub-category-2').append($('<option/>', { 
                        value: value,
                        text : MRCategoryLabels[value]
                    }));
                }); 
        });
        $('.add-item-category').on('click' , function(e) {
            e.preventDefault();
            newItem.categoriesByName    || (newItem.categoriesByName    = []);
            newItem.categoriesByNumber  || (newItem.categoriesByNumber  = []);
            newItem.categorTreeByName   || (newItem.categorTreeByName   = []);
            newItem.categorTreeByNumber || (newItem.categorTreeByNumber = []);

            // take all the available categories and add them to the table
            var l0 = $('.sub-category-0').val()||null
            var l1 = $('.sub-category-1').val()||null
            var l2 = $('.sub-category-2').val()||null
            var Names = [];
            var Numbs = [];
            MRCategoryLabels[l0]&&(Names.push(MRCategoryLabels[l0]) , Numbs.push(l0))
            MRCategoryLabels[l1]&&(Names.push(MRCategoryLabels[l1]) , Numbs.push(l1))
            MRCategoryLabels[l2]&&(Names.push(MRCategoryLabels[l2]) , Numbs.push(l2))
            $('.selectedCategories').append('<div>'+Names.join('/')+'</div>')
            // also add them to the newItem object

            newItem.categoriesByName.push(Names[Names.length-1])
            newItem.categoriesByNumber.push(Numbs[Numbs.length-1])
            newItem.categorTreeByName = newItem.categorTreeByName.concat(Names)
            newItem.categorTreeByNumber = newItem.categorTreeByNumber.concat(Numbs)
            return false;
        });
        $('.reset').on('click' , function(e) {
            e.preventDefault();
            
            $('.selectedCategories').html('');

            newItem.categoriesByName    = [];
            newItem.categoriesByNumber  = [];
            newItem.categorTreeByName   = [];
            newItem.categorTreeByNumber = [];
            return false;
        });

        // whenever an item is change on the form- change it's compliment on our temp object
        // allow for special handling when the key type is of number
        $('.newItemField').on('blur' , function() {
            // this one function does more than all of the other functions and it is only 2 lines...
            var KT=$(this).attr('keyType')
            window.newItem[this.title] = KT&&KT=='number'?Number(this.value):this.value;
        });

        // upload file to parse, and if successful add it to our temp object.
        $('input[type=file]').on('change' , function() {

            var name , file , parseFile , fileUp , loadControl = $(this)[0];

            if (fileUploadControl.files.length > 0) {
                
                file = fileUploadControl.files[0];
                
                if (newItem.imageCount==undefined)
                    newItem.imageCount = 0;
                else
                    newItem.imageCount++;

                name = 'fullPhoto' + newItem.imageCount;

                parseFile = new Parse.File(name, file);
            }
            
            parseFile.save().then(function(d) {
                
                if (!newItem.database_img_FILE_1)
                    newItem.database_img_FILE_1 = parseFile;

                else if (!newItem.database_img_FILE_2)
                    newItem.database_img_FILE_2 = parseFile;

                else if (!newItem.database_img_FILE_3)
                    newItem.database_img_FILE_3 = parseFile;

                else if (!newItem.database_img_FILE_4)
                    newItem.database_img_FILE_4 = parseFile;

                $('<img>').appendTo('.uploaded-files').attr('src' , parseFile._url).css({'max-width':'100px','max-height':'100px'});

            }, function(error) {
                // The file either could not be read, or could not be saved to Parse.
            });
        });

        //
        ////////////////////////

    })

}